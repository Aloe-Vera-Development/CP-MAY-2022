<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./css/fonts.css" />
    <link rel="stylesheet" href="./css/index.css" />
    <link rel="stylesheet" href="./css/upload.css" />
    <script type="text/javascript" src="eel.js"></script>
    <title>Мой Морж</title>
</head>
<body>
    <header class="header">
      <nav class="navigation">
        <a href="index.html" class="nav_link text-decoration-underline regular-16-title">Загрузить фото</a>
        <a href="map.html" class="nav_link regular-16-title">Карта популяций</a>
        <a href="/" class="nav_link regular-16-title">Статистика</a>
        <a href="history.html" class="nav_link regular-16-title">История отчетов</a>
      </nav>
      <div class="progammName semi-bold-20-title">Мой морж</div>
    </header>
    <div class="wrapper">
      <div class="content">
        <div class="content_formats">
          <div class="extra-bold-title mainTitle">
            Загрузите изображения для анализа популяции
          </div>
          <div class="regular-title secondTitle">
            Можете загрузить
            <span class="semi-bold-24-title">одну или более фотографий</span> в
            файловом формате JPEG или JPG
          </div>
          <div class="content_choose_formats"></div>
        </div>
      </div>

      <div class="content_choosePhoto">
        <div class="content_button_wrapper">
          <a href="#" onclick="getPathToFile()" class="button_picture_download">
            <svg class="svg_button_pic"></svg>
          </a>
          <div class="content_down_button">
            <a href="#" onclick="getPathToFile()" class="button_choose_photo  button_choose_photo_hover regular-title">
              Выбрать фото
            </a >
          </div>
        </div>
        <div class="arrow">
          <svg class="arrow_pic"></svg>
        </div>
      </div>
    </div>

<!--    <canvas id="myChart" width="1000" height="600"></canvas>-->
<!--    <button type="button" onclick="getPathToFile()">Выбрать файл</button>-->
<!--    <div id="map" style="width: 600px; height: 400px"></div>-->

<!--    <script>-->
<!--    const ctx = document.getElementById('myChart').getContext('2d');-->
<!--    const myChart = new Chart(ctx, {-->
<!--        type: 'line',-->
<!--        data: {-->
<!--            labels: ['2019:09:17 15:21:43', '2019:09:18 15:21:43', '2019:09:20 15:21:43', ],-->
<!--            datasets: [{-->
<!--                label: 'Популяция моржей',-->
<!--                borderColor: 'rgb(75, 192, 192)',-->
<!--                backgroundColor: 'rgb(75, 192, 192)',-->
<!--                data: [1, 5, 3],-->
<!--                lineTension: 0.5-->

<!--            }]-->
<!--        },-->
<!--        options: {-->
<!--            responsive: true,-->
<!--            plugins: {-->
<!--              filler: {-->
<!--                propagate: false,-->
<!--              },-->
<!--              title: {-->
<!--                display: true,-->
<!--              },-->
<!--            },-->
<!--            interaction: {-->
<!--              intersect: false,-->
<!--            }-->
<!--          },-->
<!--    });-->
<!--    myChart.canvas.parentNode.style.height = '1000px';-->
<!--    myChart.canvas.parentNode.style.width = '600px';-->
<!--    </script>-->

    <script type="text/javascript">
        // ymaps.ready(init);
        // var myMap;
        // function init(){
        //     myMap = new ymaps.Map("map", {
        //         center: [69.465028, 58.533478],
        //         zoom: 12,
        //         type: 'yandex#hybrid',
        //         controls: ['zoomControl', 'typeSelector', 'fullscreenControl']
        //     });
        //     eel.getLastData()(r => {
        //         console.log(r)
        //         var arr = [];
        //         for (let i = 0; i < r.length; i++) {
        //             var title = '<b style="font-size: 18px">' + r[i][1] + ' моржей</b><br>Дата: ' + r[i][3].split(' ')[0].replaceAll(':', '.') + '<br>Снято на: ' + r[i][6] + '<br><a href="#">Детальная страница</a>';
        //             arr[i] = new ymaps.Placemark([r[i][4], r[i][5]], {
        //                 clusterCaption: 'Фотография '+(i+1),
        //                 balloonContent: title
        //             }, {
        //                 preset: 'islands#blueCircleDotIcon',
        //             });
        //         }
        //
        //         var myClusterer = new ymaps.Clusterer();
        //         myClusterer.add(arr);
        //         myMap.geoObjects.add(myClusterer);
        //     })
        // }
        function getPathToFile() {
            eel.addToDB()(r => {
                console.log(r)
                $('.mainTitle').text('Отлично! Осталось запустить анализ')
                $('.secondTitle').html('<span class="semi-bold-24-title">Нажмите на кнопку</span> под\n' +
                    '            списком фото и дождитесь результатов')
                $('.button_choose_photo').text('Запустите анализ').attr('onclick', '')
                var str = '<div class="main-photos">\n'
                for (i = 0; i < r.length && i < 4; i++) {
                    str = str + '<div class="photos-img">\n' +
                    '                <img src="/' + r[i].photo + '" alt="" class="img-photos" />\n' +
                    '              </div>\n'
                }
                $('.button_picture_download').html(str+'</div>').attr('onclick', '')
                // var arr = new ymaps.GeoObjectCollection();
                // for (let i = 0; i < r.length; i++) {
                //     arr.add(new ymaps.Placemark([r[i][1], r[i][2]], {
                //         balloonContent: r[i][0]
                //     }, {
                //         preset: 'islands#blueCircleDotIcon',
                //     }));
                //
                // }
                // myMap.geoObjects.add(arr);
            })
        }
    </script>
</body>
</html>