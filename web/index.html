<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./css/fonts.css" />
    <link rel="stylesheet" href="./css/index.css" />
    <link rel="stylesheet" href="./css/upload.css" />
    <script type="text/javascript" src="eel.js"></script>
    <title>Мой Морж</title>
</head>
<body>
    <header class="header">
      <nav class="navigation">
        <a href="index.html" class="nav_link text-decoration-underline regular-16-title">Загрузить фото</a>
        <a href="map.html" class="nav_link regular-16-title">Карта популяций</a>
        <a href="diagram.html" class="nav_link regular-16-title">Статистика</a>
        <a href="history.html" class="nav_link regular-16-title">История отчетов</a>
      </nav>
      <div class="progammName semi-bold-20-title">Мой морж</div>
    </header>
    <div class="wrapper">
      <div class="content content2" id="cont2" hidden>
        <div class="extra-bold-title mainTitle">Распознано 532 особи</div>
        <div class="photos-content">

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>
              <div class="text-wrapper">
                <div class="date regular-16-title">27 ноя' 21г..</div>
                  <div class="more regular-20-title">
                    <a
                      href="./cardPhotoInfo.html"
                      class="link-photo-info more-link"
                    >
                      Подробнее
                      <div class="more-svg-div">
                        <svg class="more-svg"></svg>
                      </div>
                    </a>
                  </div>

                </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" width="160px" height="160px"/>
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>
              <div class="text-wrapper">
                <div class="date regular-16-title">27 ноя' 21г.</div>
                  <div class="more regular-20-title">
                    <a
                      href="./cardPhotoInfo.html"
                      class="link-photo-info more-link"
                    >
                      Подробнее
                      <div class="more-svg-div">
                        <svg class="more-svg"></svg>
                      </div>
                    </a>
                  </div>

                </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>
              <div class="text-wrapper">
                <div class="date regular-16-title">27 ноя' 21г.</div>
                  <div class="more regular-20-title">
                    <a
                      href="./cardPhotoInfo.html"
                      class="link-photo-info more-link"
                    >
                      Подробнее
                      <div class="more-svg-div">
                        <svg class="more-svg"></svg>
                      </div>
                    </a>
                  </div>

                </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>
              <div class="text-wrapper">
                <div class="date regular-16-title">27 ноя' 21г.</div>
                  <div class="more regular-20-title">
                    <a
                      href="./cardPhotoInfo.html"
                      class="link-photo-info more-link"
                    >
                      Подробнее
                      <div class="more-svg-div">
                        <svg class="more-svg"></svg>
                      </div>
                    </a>
                  </div>

                </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>
              <div class="text-wrapper">
                <div class="date regular-16-title">27 ноя' 21г.</div>
                  <div class="more regular-20-title">
                    <a
                      href="./cardPhotoInfo.html"
                      class="link-photo-info more-link"
                    >
                      Подробнее
                      <div class="more-svg-div">
                        <svg class="more-svg"></svg>
                      </div>
                    </a>
                  </div>

                </div>
            </div>
          </div>

        </div>
      </div>
      <div class="content" id="cont1">
        <div class="content_formats">
          <div class="extra-bold-title mainTitle">
            Загрузите изображения для анализа популяции
          </div>
          <div class="regular-title secondTitle">
            Можете загрузить
            <span class="semi-bold-24-title">одну или более фотографий</span> в
            файловом формате JPEG или JPG
          </div>
          <div class="content_choose_formats"></div>
        <div class="photos-content" hidden>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>

              <div class="date regular-16-title">27 ноя' 21г.</div>
            </div>
            <div class="left-div">
              <button class="cross-card-div" onclick="deleteElement()">
                <svg class="cross-card-div-svg"></svg>
              </button>
              <div class="more regular-20-title">
                <a
                  href="./cardPhotoInfo.html"
                  class="link-photo-info more-link"
                >
                  Подробнее
                  <div class="more-svg-div">
                    <svg class="more-svg"></svg>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>

              <div class="date regular-16-title">27 ноя' 21г.</div>
            </div>
            <div class="left-div">
              <button class="cross-card-div">
                <svg class="cross-card-div-svg"></svg>
              </button>
              <div class="more regular-20-title">
                <a
                  href="./cardPhotoInfo.html"
                  class="link-photo-info more-link"
                >
                  Подробнее
                  <div class="more-svg-div">
                    <svg class="more-svg"></svg>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>

              <div class="date regular-16-title">27 ноя' 21г.</div>
            </div>
            <div class="left-div">
              <button class="cross-card-div">
                <svg class="cross-card-div-svg"></svg>
              </button>
              <div class="more regular-20-title">
                <a
                  href="./cardPhotoInfo.html"
                  class="link-photo-info more-link"
                >
                  Подробнее
                  <div class="more-svg-div">
                    <svg class="more-svg"></svg>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>

              <div class="date regular-16-title">27 ноя' 21г.</div>
            </div>
            <div class="left-div">
              <button class="cross-card-div">
                <svg class="cross-card-div-svg"></svg>
              </button>
              <div class="more regular-20-title">
                <a
                  href="./cardPhotoInfo.html"
                  class="link-photo-info more-link"
                >
                  Подробнее
                  <div class="more-svg-div">
                    <svg class="more-svg"></svg>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <div class="card-photo">
            <div class="card-img">
              <img src="./img/1test.png" alt="" class="img-card" />
            </div>
            <div class="photo-info">
              <div class="text medium-24-title">13 моржей</div>

              <div class="date regular-16-title">27 ноя' 21г.</div>
            </div>
            <div class="left-div">
              <button class="cross-card-div">
                <svg class="cross-card-div-svg"></svg>
              </button>
              <div class="more regular-20-title">
                <a
                  href="./cardPhotoInfo.html"
                  class="link-photo-info more-link"
                >
                  Подробнее
                  <div class="more-svg-div">
                    <svg class="more-svg"></svg>
                  </div>
                </a>
              </div>
            </div>
          </div>

        </div>

        </div>
      </div>

      <div class="content_choosePhoto">
        <div class="content_button_wrapper">
          <a href="#" onclick="getPathToFile()" class="button_picture_download">
            <svg class="svg_button_pic"></svg>
          </a>

          <div class="content_down_button">
            <a href="#" onclick="getPathToFile()" class="button_choose_photo  button_choose_photo_hover regular-title">
              Выбрать фото
            </a >
            <button id="btn-pop" onclick="togglePopUp()" class="button_choose_photo button-hover button-next regular-title black-text-color" hidden>
              Посмотреть загруженные
            </button>
          </div>
        </div>
        <div class="arrow">
          <svg class="arrow_pic"></svg>
        </div>
      </div>
    </div>

      <div class="pop-up-wrapper disctivate">
        <div class="pop-up-title">
          <div class="title-text extra-32-bold-title">
            Выбранные изображения
          </div>
          <div class="exit-cross">
            <button
              class="button-exit-cross button-trans button-hover"
              onclick="togglePopUp()"
            >
              <div class="svg-div"><svg class="exit-cross"></svg></div>
            </button>
          </div>
        </div>

        <div class="pop-up-content">
          <div class="Row">
            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>

            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>

            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>

            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>

            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>

            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>
          </div>

          <div class="Row">
            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>

            <div class="photo-card">
              <div class="delete-hover disctivate">
                <div class="svg-div-bucket"><svg class="svg-bucket"></svg></div>
              </div>
              <img src="./img/test6.png" alt="" class="card-img" />
            </div>
            <div class="button-to-add button-trans button-hover">
              <div class="svg-add-plus"><svg class="svg-plus"></svg></div>
            </div>
          </div>
        </div>
      </div>
    <script src="./js/cardInfoPopUp.js"></script>
    <script src="./js/deletePhotoCard.js"></script>

<!--    <canvas id="myChart" width="1000" height="600"></canvas>-->
<!--    <button type="button" onclick="getPathToFile()">Выбрать файл</button>-->
<!--    <div id="map" style="width: 600px; height: 400px"></div>-->

<!--    <script>-->
<!--    const ctx = document.getElementById('myChart').getContext('2d');-->
<!--    const myChart = new Chart(ctx, {-->
<!--        type: 'line',-->
<!--        data: {-->
<!--            labels: ['2019:09:17 15:21:43', '2019:09:18 15:21:43', '2019:09:20 15:21:43', ],-->
<!--            datasets: [{-->
<!--                label: 'Популяция моржей',-->
<!--                borderColor: 'rgb(75, 192, 192)',-->
<!--                backgroundColor: 'rgb(75, 192, 192)',-->
<!--                data: [1, 5, 3],-->
<!--                lineTension: 0.5-->

<!--            }]-->
<!--        },-->
<!--        options: {-->
<!--            responsive: true,-->
<!--            plugins: {-->
<!--              filler: {-->
<!--                propagate: false,-->
<!--              },-->
<!--              title: {-->
<!--                display: true,-->
<!--              },-->
<!--            },-->
<!--            interaction: {-->
<!--              intersect: false,-->
<!--            }-->
<!--          },-->
<!--    });-->
<!--    myChart.canvas.parentNode.style.height = '1000px';-->
<!--    myChart.canvas.parentNode.style.width = '600px';-->
<!--    </script>-->

    <script type="text/javascript">
        // ymaps.ready(init);
        // var myMap;
        // function init(){
        //     myMap = new ymaps.Map("map", {
        //         center: [69.465028, 58.533478],
        //         zoom: 12,
        //         type: 'yandex#hybrid',
        //         controls: ['zoomControl', 'typeSelector', 'fullscreenControl']
        //     });
        //     eel.getLastData()(r => {
        //         console.log(r)
        //         var arr = [];
        //         for (let i = 0; i < r.length; i++) {
        //             var title = '<b style="font-size: 18px">' + r[i][1] + ' моржей</b><br>Дата: ' + r[i][3].split(' ')[0].replaceAll(':', '.') + '<br>Снято на: ' + r[i][6] + '<br><a href="#">Детальная страница</a>';
        //             arr[i] = new ymaps.Placemark([r[i][4], r[i][5]], {
        //                 clusterCaption: 'Фотография '+(i+1),
        //                 balloonContent: title
        //             }, {
        //                 preset: 'islands#blueCircleDotIcon',
        //             });
        //         }
        //
        //         var myClusterer = new ymaps.Clusterer();
        //         myClusterer.add(arr);
        //         myMap.geoObjects.add(myClusterer);
        //     })
        // }
        var suka = []
        function getPathToFile() {
            eel.addToDB()(r => {
                suka = r
                console.log(r)
                $('.mainTitle').text('Отлично! Осталось запустить анализ')
                $('.secondTitle').html('<span class="semi-bold-24-title">Нажмите на кнопку</span> под\n' +
                    '            списком фото и дождитесь результатов')
                $('.button_choose_photo').text('Запустите анализ').attr('onclick', 'getPrediction()')
                var str = '<div class="main-photos">\n'
                for (i = 0; i < r.length && i < 4; i++) {
                    str = str + '<div class="photos-img">\n' +
                    '                <img src="/' + r[i].photo + '" alt="" class="img-photos" />\n' +
                    '              </div>\n'
                }
                $('.button_picture_download').html(str+'</div>').attr('onclick', '')
                // var arr = new ymaps.GeoObjectCollection();
                // for (let i = 0; i < r.length; i++) {
                //     arr.add(new ymaps.Placemark([r[i][1], r[i][2]], {
                //         balloonContent: r[i][0]
                //     }, {
                //         preset: 'islands#blueCircleDotIcon',
                //     }));
                //
                // }
                // myMap.geoObjects.add(arr);
            })
        }
        function getPrediction() {
            console.log(suka)
            $('.mainTitle').text('Обработка...')
            $('.secondTitle').html('')
            $('.button_choose_photo').text('Обработка...').attr('onclick', '').prop("disabled",true)
            for (i = 0; i < suka.length+1; i++) {
              // if (i == suka.length) {
              //   $('.button_choose_photo').hide()
              //   $('#btn-pop').show()
              //   $('#cont1').hide()
              //   $('#cont2').show()
              //
              //   break;
              // }
                eel.getPrediction('web/'+suka[i].photo, suka[i].date)(r => {
                    console.log(r)
                })
            }

            // $('.photos-content').show()
            //
            // $('.mainTitle').text('Обработано ' + suka.length + ' фотографий')

        }
    </script>
</body>
</html>